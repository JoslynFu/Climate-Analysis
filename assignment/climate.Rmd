---
title: "Climate Exercise"
author: "Joslyn Fu & Kelly Yuan"
output: github_document
---


__This is a climate change excerise by Joslyn and Jiaming to dive into how the main indicators of climate change, including C02 trends, global temperature change.__

------------------------

# CO2 Trends

First, we exmaine the CO2 trends. 

## Dataset Description 

This is from the [NASA Climate Change Section ](http://climate.nasa.gov/vital-signs/carbon-dioxide/), and the original data is obtained from the National Oceanic and Atmospheric Administration, specifically the Earth System Research Laboratories.

The Data is shown below:

```{r message=FALSE}
library(tidyverse)
```

```{r message=FALSE}

co2 <- 
read_table("https://raw.githubusercontent.com/espm-157/climate-template/master/assignment/co2_mm_mlo.txt", 
                  comment="#",
                  col_names = c("year", "month", "decimal_date", "average",
                                "interpolated", "trend", "days"),
                  na = c("-1", "-99.99"))
co2
```

We then visualize the data. We use the interpolated column as Y because it will omit gaps.

```{r}
ggplot(co2, aes(x = decimal_date, y = trend)) + geom_line() 
```

## Trend from the Graph

According to the dataset, C02 level usually reaches its annual maximum around May and June, and its minimum around September and Octobor. Based on our research, much of this variation happens because of the role of plants in the carbon cycle. Plants extract CO2 from the atmosphere, along with sunlight and water, to make food and other substances that they need to grow —— this is the process of _photosysthesis_.  Therefore, CO2 in the atmosphere decreases during the growing season and increases during the rest of the year, which leads to maximum buildup in May before photosynthesis begins to take over in the summer time. Photosynthesis, in which plants take up CO2 from the atmosphere and release oxygen, dominates during the growing season (the warmer part of the year). Respiration, by which plants and animals take up oxygen and release CO2, occurs all the time but dominates during the colder months of the year.

In computing the "average" column, the scientists use the monthly mean CO2 mole fraction determined from daily averages. The "interpolated" column includes average values from the "average" column and interpolated values where data are missing. Based on the information given by NASA, in calculating the interpolated value, they use a 7-year rolling avearage. Then for the "trend" line, they determine the "trend"value for each month by removing the seasonal cycle.


------------------------

# Global Temperatre 

After examining CO2 trend, we look into the global temperature data from [NASA Global Climate Change Section](http://climate.nasa.gov/vital-signs/global-temperature).


## Dataset Description

The temperature dataset contains information about gobal annual mean temperature from 1880 to 2019 relative to 1951-1980 average temperatures. This graph illustrates the change in global surface temperature relative to 1951-1980 average temperatures.

Please see the below dataset table.

```{r}
temperature <- read_table(
  "http://climate.nasa.gov/system/internal_resources/details/original/647_Global_Temperature_Data_File.txt",
  skip = 5,
  col_names = c("year","temp","lowess5"))

temperature
```

## Temperature Graph

This is the trend in global mean temperatures over time.

```{r}
temperature %>%
  ggplot(aes(x = year, y = temp)) + geom_line()
```

According to the graph, the overall trend in global temperature is increasing. Starting from 2012, the increase in global temperature is surging at a higher rate. 

## A Possible Pause?

The [2013 IPCC Report](https://www.ipcc.ch/pdf/assessment-report/ar5/wg1/WG1AR5_SummaryVolume_FINAL.pdf) included a tentative observation of a "much smaller increasing trend" in global mean temperatures since 1998 than was observed previously.  This led to much discussion in the media about the existence of a "Pause" or "Hiatus" in global warming rates, as well as much research looking into where the extra heat could have gone.  (Examples discussing this question include articles in [The Guardian](http://www.theguardian.com/environment/2015/jun/04/global-warming-hasnt-paused-study-finds), [BBC News](http://www.bbc.com/news/science-environment-28870988), and [Wikipedia](https://en.wikipedia.org/wiki/Global_warming_hiatus)).

Given the trend plotted above, there is no evidence for such a pause. The temperature keeps rising since the early 1960s with faster pace. It took about 40 years from 1960 to 2000 to rise from below 0 Celsius degree to 0.5  Celsius degree; however, to rise from 0.5 to 1 Celsius degree, it took less than 20 years. These are just rough estimates based on the graph. If we're given more data that focuses on the difference among each year/decade, we can appraoch the truth of pause more accurately.

## Exploring Rolling Averages

Let's stop here and dive deep into the rolling averages. A 5-year average is like a 5-year window around a specific date and the average of those values, while the annual avearage is just the average of tempeatures recorded for a 12-month window, starting from each year's January to December. Here, we add three columns to the original temperature dataframe, representing a 5-year average, a 10-year one, and a 20-year one, respectively. We also attach a graph for each one.

To find the rolling average, we first need to install its corresponding package:

```{r}
install.packages("RcppRoll")
library("RcppRoll")
```

And then, it's time to draw!

```{r}
temperature %>%
  mutate(ave5 = roll_mean(temp,5,fill=NA)) %>%
  ggplot(aes(x = year, y = ave5)) + geom_line()
```

```{r}
temperature %>%
  mutate(ave10 = roll_mean(temp,10,fill=NA))%>%
  ggplot(aes(x = year, y = ave10)) + geom_line()
```

```{r}
temperature %>%
  mutate(ave20 = roll_mean(temp,20,fill=NA))%>%
  ggplot(aes(x = year, y = ave20)) + geom_line()
```

The differences among these three graphs are very significant due to the different means I have on the y-axis. When we increase the time window, the trend would generally grow flat and smooth. This is because as we even out the temperatrue over a larger time window, the difference between 2 time window would be smaller. 

------------------------

# Melting Ice Sheets

The ice loss has been extremely massive over the past years. In order to investigate this problem, we look into both __Antarctica__ (green line) and __Greenland__ (blue line) mass data from 2002 [NASA Global Climate Change Section - Ice Sheets](https://climate.nasa.gov/vital-signs/ice-sheets/).

## Dataset Description


```{r}
ice <- read_csv("http://climate.nasa.gov/system/internal_resources/details/original/499_GRN_ANT_mass_changes.csv",skip = 10,
                col_names = c("time","greenland_mass","antarctica_mass"))
ice
```

There are three columns in the table. 
i) 'Time' in units of 'year-day'
ii) 'greenland_mass' in units of 'Gt'
iii) 'antarctica_mass' in units of 'Gt'

The numbers are from Ice mass measurement by NASA's GRACE satellites.
The uncertainty depends on the accuracy of the satellites. The missing values indicate a gap between missions during that time (from June 2017 to June 2018).

## Ice Graph for Both Two Masses

```{r}
ice %>%
  ggplot(aes(x = time)) + 
  geom_line(aes(y = greenland_mass), col="blue") +
  geom_line(aes(y = antarctica_mass), col = "red")
```

The trend is that both ice mass are decreasing. In each year, there is a wave-like shape, suggesting that there is a decrease in summer and an increase in winter. This is due to the natural temperature variation in different reasons. However, greenland mass is decreasing at a faster rate than antarctica mass. While greenland mass was initially heavier than antarctica mass, greenland mass is now less than the antarctica mass.

------------------------

# Rising Sea Level

Rising sea level is another vital indicator of climate change. According to NASA, sea level rise is caused primarily by two factors: the added water from melting ice sheets and glaciers and the expansion of seawater as it warms. We analyze rising sea level from the information provided by [NASA Global Climate Change Section - Sea Level](https://climate.nasa.gov/vital-signs/sea-level/)


## Sea Level Dataset

The data is obtained from Satellite sea level observations. We have data from 1993 to present. We give credit to the NASA Goddard Space Flight Center.


```{r}
sea_level <- read_table("http://climate.nasa.gov/system/internal_resources/details/original/121_Global_Sea_Level_Data_File.txt",
                        skip = 50,
                        col_names = c("altimeter_type","merged_file_cycle","number_of_observations","number_of_weighted_observations",
                                      "gmsl_variation_adjustment_not_applied","standard_deviation_of_gmsl_variation_no_adjustment",
                                      "gmsl_variation_adjustment_applied","standard_deviation_of_gmsl_adjustment",
                                      "smoothed_gmsl_variation","smoothed_gmsl_variation_removed_signal"))
sea_level
```


According to the table, GMSL denotes Global Mean Sea Level. We are able to see the variations in global mean sea levels and their standard deviations. We make the plot below using the smoothed global mean sea level variation and the one with removed signal.

## Sea Level Graph

```{r}
sea_level %>%
  ggplot(aes(x = number_of_observations)) +
  geom_line(aes(y = smoothed_gmsl_variation),col= "blue") +
  geom_line(aes(y = smoothed_gmsl_variation_removed_signal),col= "red")
```

The graph above tracks the change in sea level since 1993 as observed by satellites. We can easily see the variation is increasing, suggesting that the sea level is rising gradually.

# Arctic Sea Ice

- <http://nsidc.org/data/G02135>
- <ftp://sidads.colorado.edu/DATASETS/NOAA/G02135/north/daily/data/N_seaice_extent_daily_v3.0.csv>


## Question 1:

- Describe the data set: what are the columns and units? 
- Where do these data come from? 
- What is the uncertainty in measurement? Resolution of the data? Interpretation of missing values?


## Question 2:

Construct the necessary R code to import this data set as a tidy `Table` object.
```{r}
library(dplyr)
library(lubridate)
```

```{r}
sea_ice <- read_csv("https://github.com/espm-157/climate-template/releases/download/data/N_seaice_extent_daily_v3.0.csv",
                    skip = 2, col_names = c("year","month","day","extent","missing"))
sea_ice
```

```{r}
avg_sea_ice <- sea_ice %>% 
  mutate(date = make_date(year, month, day)) %>%
  group_by(year(date)) %>%
  summarize(avg_extent = mean(extent, na.rm = TRUE))

avg_sea_ice
```

```{r}
names(avg_sea_ice)[1] <- "year"
avg_sea_ice%>%
  ggplot(aes(x= year,y=avg_extent))+geom_line()
```

## Question 3:

Plot the data and describe the trends you observe.  


# Exercise V: Longer term trends in CO2 Records


The data we analyzed in the unit introduction included CO2 records dating back only as far as the measurements at the Manua Loa observatory.  To put these values into geological perspective requires looking back much farther than humans have been monitoring atmosopheric CO2 levels.  To do this, we need another approach.


[Ice core data](http://cdiac.ornl.gov/trends/co2/ice_core_co2.html):

Vostok Core, back to 400,000 yrs before present day 

- Description of data set: <http://cdiac.esd.ornl.gov/trends/co2/vostok.html>
- Data source: <http://cdiac.ornl.gov/ftp/trends/co2/vostok.icecore.co2>

## Questions / Tasks:

- Describe the data set: what are the columns and units? Where do the numbers come from? 
- What is the uncertainty in measurment? Resolution of the data? Interpretation of missing values?
- Read in and prepare data for analysis.
- Reverse the ordering to create a chronological record.  
- Plot data
- Consider various smoothing windowed averages of the data. 
- Join this series to Mauna Loa data
- Plot joined data
- Describe your conclusions

```{r}
#table <- read.fwf("https://cdiac.ess-dive.lbl.gov/ftp/trends/co2/vostok.icecore.co2",
#                  sep = "\\",skip=21,col.names = c("depth","age of the ice","age of the air","co2 concentration"))
#table
```


